/*TRIGGER PARA CADA VEZ
QUE UNA USUARIA INSERTA EL PESO EN LA TABLA REVISION MEDICA,
SE ACTUALICE EL PESO DE LA TABLA USUARIO
*/
USE MenstruApp
BEGIN TRAN
ALTER
--CREATE
TRIGGER modificarPeso 
ON REVISIONMEDICA
AFTER INSERT AS
BEGIN
	UPDATE
		USUARIO
	SET
		USUARIO.PESO = REVISION.PESO
	FROM
		USUARIO AS USU
	INNER JOIN
		EMBARAZO AS EM
	ON USU.NICK = EM.ID_USUARIO
	INNER JOIN 
		(
		/*ASI COGE EL REGISTRO MAS NUEVO DEL PESO*/
		SELECT TOP 1 ID_EMBARAZO,PESO, FECHA_CITA_ACTUAL
		FROM REVISIONMEDICA
		ORDER BY FECHA_CITA_ACTUAL DESC
		) AS REVISION
	ON EM.ID = REVISION.ID_EMBARAZO 

	

END


SELECT * FROM USUARIO
SELECT * FROM EMBARAZO
SELECT * FROM REVISIONMEDICA

INSERT INTO REVISIONMEDICA (ID_EMBARAZO, PESO, CINTURA, CADERA, ESTADOFETO, OBSERVACIONES,FECHA_CITA_ACTUAL, FECHA_SIGUIENTE_CITA)
VALUES('CDBD8786-4033-43F3-B253-4A2F85EE6E64', 50,50,50, 'TODO BIEN', 'TODO PERFE TIA', '20190725','20200526')

INSERT INTO REVISIONMEDICA (ID_EMBARAZO, PESO, CINTURA, CADERA, ESTADOFETO, OBSERVACIONES, FECHA_CITA_ACTUAL,FECHA_SIGUIENTE_CITA)
VALUES('CDBD8786-4033-43F3-B253-4A2F85EE6E64', 70,50,50, 'TODO BIEN', 'TODO PERFE TIA', '20190626','20200526')

INSERT INTO REVISIONMEDICA (ID_EMBARAZO, PESO, CINTURA, CADERA, ESTADOFETO, OBSERVACIONES, FECHA_CITA_ACTUAL,FECHA_SIGUIENTE_CITA)
VALUES('CDBD8786-4033-43F3-B253-4A2F85EE6E64', 150,50,50, 'TODO BIEN', 'TODO PERFE TIA', '20190627','20200526')
